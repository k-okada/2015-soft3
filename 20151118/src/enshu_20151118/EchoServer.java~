import EchoApp.*;
import org.omg.CosNaming.*;
import org.omg.CosNaming.NamingContextPackage.*;
import org.omg.CORBA.*;
import org.omg.PortableServer.*;
import org.omg.PortableServer.POA;
import java.util.Properties;

class EchoImpl extends EchoApp.EchoPOA{
    private ORB orb;
    public void setORB(ORB orb_val){
	orb=orb_val;
    }

    public void echoString(String input){
	System.err.println(">> "+ input);
    }

    public void shutdown(){
	orb.shutdown(false);
    }
}

public class EchoServer{
    public static void main(String args[]){
	try{
	    ORB orb=orb.init(args,null);

	    POA rootpoa=POAHelper.narrow(orb.resolve_initial_references("RootPOA"));
	    rootpoa.the_POAManager().activate();
	    EchoImpl echoImpl=new EchoImpl();
	    echoImpl.setORB(orb);
	    
	    org.omg.CORBA.Object ref = rootpoa.servant_to_references(echoImpl);
	    Echo href=EchoHelper.narrow(ref);
	    
	    org.omg.CORBA.Object objref = orb.resolve_initial_references("NameService");
	    NamingContextExt ncRef=NamingContextExtHelper.narrow(objref);

	    String name="EchoApp/Echo";
	    NameComponent path[]=ncRef.to_name(name);
	    System.out.println("EchoServer ready and waiting...");
	    
	    orb.run();
	}
	catch(Exception e){
	    System.err.println("ERROR: " + e);
	    e.printStackTrace(System.out);
	}
	System.out.println("EchoServer Exiting...");
    }
}
